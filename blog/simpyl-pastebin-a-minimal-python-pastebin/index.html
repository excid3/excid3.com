<!DOCTYPE html>
<html>
  <head>
    <title>Simpyl Pastebin &#8211; A minimal Python Pastebin</title>
    <meta name="author" content="Chris Oliver">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta name="google-site-verification" content="k8E8tt4Xn45P84zs5M6Z-4cMIGwdbGMJSDSkL6VzvMk" />

    <!--<link rel="shortcut icon" href="favicon.png">-->
    <link href='/assets/global-09e65ed72b4f08933d57dbbe6ee22514.css' rel='stylesheet' type='text/css' />


    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet" />

    <script type="text/javascript" src="/js/prism.js"></script>

    <script type="text/javascript" data-cfasync="false">
      (function() {
        var config = {
          kitId: 'voa6eso',
          scriptTimeout: 3000
        };
        var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
      })();
    </script>

    <link href="https://plus.google.com/106699287110566383664/" rel="author" />
  </head>
  <body>
    <div class="fluid-container header">
  <div class="container">
    <nav class="pull-right">
      <!--<a href="http://gorails.com" class="btn btn-gorails btn-gorails-green">Learn Ruby On Rails</a>-->
      <!--<a href="/prototype">Prototype</a>
      <a href="/improve">Improve</a>
      <a>|</a>-->
      <a href="http://gorails.com">Learn Ruby on Rails</a>
      <a>|</a>
      <a href="/blog">Blog</a>
      <a href="/contact" class="btn btn-gorails btn-gorails-red">Hire Me</a>
    </nav>
    <h1 class="name"><a href="/">Chris Oliver</a></h1>
  </div>
</div>


    <section id="blog">
      <div class="container">
        <div class="row">
          <div class="span8 offset2">
            <div class="article-head">
              <h2 class="title"><a href="/blog/simpyl-pastebin-a-minimal-python-pastebin" class="js-pjax">Simpyl Pastebin &#8211; A minimal Python Pastebin</a></h2>
              <p class="date">Dec 29, 2009</p>
            </div><!--/.article-head-->

            <div class="article-content">
              <p>Tonight I needed to relax a bit and figured what better way than to take a straight caffeine injection, fire up the old ‘puter, and hammer out an <a href="http://github.com/excid3/simpyl_pastebin">extremely simple pastebin </a>using Python and Django. I wanted this project to be an example for others to get the basic idea of a pastebin, Python, and Django as well. So why wait, let’s jump right in.</p>

<p>First of all, with Django, we have the basic project. The project is the top level directory files: manage.py (controls the Django application), urls.py (contains the url configurations), settings.py (contains the application settings), and <strong>init</strong>.py (which just kind of sits there and looks pretty so that importing works).</p>

<p>First, a quick rundown of the configuration. We are using sqlite3 currently. This is a relation database that is stored in a file meaning that you will not need an sql database server running. All the data will be stored in the database file (by default is simpyl.dat) meaning that you can actually copy the directory and everything will move with it as opposed to having it on a remote sql database server.</p>

<p>In urls.py we have the following code:</p>

<pre><code>    (r'^$', 'simpyl_pastebin.pastebin.views.main'),
    (r'', 'simpyl_pastebin.pastebin.views.fetch_paste'),
</code></pre>

<p>This is fairly self explanatory. Basically the regex’d url on the left will be sent to the module function that is on the right. First we have the root domain pointing to the pastebin/views.py main() function. The next line takes absolutely any url that wasn’t already done and uses the fetch_paste function.</p>

<p>Before we get to the view functions that handle the actual pages, let’s take a look at our database table. This is located in pastebin/models.py, but I’ll paste the code here as well:</p>

<pre><code>from django.db import models

class Paste(models.Model):
    content = models.CharField(max_length=1000000)
    url = models.CharField(max_length=32)
</code></pre>

<p>This declares the “paste” table in our database. Object-Relational Mapping is used to map a table to objects of a class. Our Paste class is the object that is created and retrieved for each paste and retrieval. It has two properties, the actual paste content, and the url. The url is a simple md5 hash of the content to make for easy url generation. What we will do in the fetch_paste function is to take the url someone is trying to visit, see if it matches a url from the paste table and if it does we display that paste’s content. If it doesn’t we send them back to the homepage.</p>

<p>Now that we have the basic understand of the structure of the site, we need to actually implement it and get the logic working. First let us take a look at the logic behind the site home in the main() function:</p>

<pre><code>def main(request):
    previous = request.POST.get('paste', '')

    if previous:
        id = hashlib.md5(previous).hexdigest()

        try:
            Paste.objects.get(url=id)
        except:
            p = Paste(content=previous, url=id)
            p.save()

        previous = 'http://%s/%s' % (request.get_host(), id)

    t = loader.get_template('pastebin/templates/index.html')
    c = Context({
        'previous': previous
    })

    return http.HttpResponse(t.render(c))
</code></pre>

<p>If you look through the index.html page that is rendered, we see that the textarea has a name of “paste”. So in the first line of this function, if we find that the page was submitted and there was something in the textarea we want to retrieve it, or if not, populate the variable with an empty string. Next we compute the md5 and check if there was anything or not. If there was, we want to check the database for an existing paste that is the exact url as this one. If there is we don’t bother creating anything new, just give them the link from the earlier created one. If we don’t find anything, we create a new Paste object (an entry in the table) and save it to the database. Afterwards we setup the variables and the template to render for the page to be displayed and return it.</p>

<p>Now for the retrieval of a paste, it’s even simpler:</p>

<pre><code>def fetch_paste(request):
    url = request.META.get('PATH_INFO', '')[1:]
    content = ""

    try:
        p = Paste.objects.get(url=url)
    except:
        t = loader.get_template('pastebin/templates/index.html')
        c = Context({
            'error': "Paste '%s' does not exist." % url
        })
        return http.HttpResponse(t.render(c))

    return http.HttpResponse(p.content)
</code></pre>

<p>In fetch_paste, we grab the url from the request. Then we attempt to find a paste that matches that url. If we do find one, we simply render the content of the paste, if not we render the homepage and display the error.</p>

<p>Nothing much to it. Fairly straight forward. Reading through the Django documentation and tutorial will make this clearer where I kind of skimmed over (which was probably in most areas). More of getting the logic and flow down than the syntax was my goal. Hopefully this helps!</p>


              <p><strong>P.S.</strong> <a href="https://twitter.com/excid3/">You might enjoy following me on Twitter.</a></p>
            </div><!--/.article-content-->

            <nav class="share">
              <a href="https://twitter.com/share" class="twitter-share-button" data-via="excid3" data-related="excid3">Tweet</a>
              <div class="g-plusone" data-size="medium"></div>
              <script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script><script type="IN/Share" data-counter="right"></script>
            </nav>

            <div class="blog-navigation">
              <div class="pull-left">
                
                <a href="/blog/pyinstaller-followup-building-python-executables-on-windows" title="PyInstaller Followup &#8211; Building Python Executables on Windows" class="btn btn-gorails btn-gorails-red">&laquo; PyInstaller Followup &#8211; Building Python Executables on Windows</a>
                
              </div>

              <div class="pull-right">
                
                <a href="/blog/offline-package-installation-full-circle-magazine" title="Offline Package Installation &#8211; Full Circle Magazine" class="btn btn-gorails btn-gorails-red">Offline Package Installation &#8211; Full Circle Magazine &raquo; </a>
                
              </div>
            </div>

            <div id="disqus_thread"></div>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            <div class="light-well about">
              <a href="http://excid3.com">
                <div class="pull-left">
                  <img src="http://www.gravatar.com/avatar/ce795239ba5dd2384fc2f88ffaff5451.png" alt="Chris Oliver" />
                </div>
                <p>Chris Oliver specializes in web development and user experience design with Ruby on Rails, Javascript, HTML5, and CSS3 in St. Louis, MO</p>
              </a>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!--
<div id="footer-nav">
  <ul>
    <li><a class="home" href="http://excid3.com/blog">home</a></li>
    <li><a class="rss" href="http://feeds.feedburner.com/excid3">rss feed</a></li>
    <li><a class="archives" href="http://excid3.com/blog/archives/">archives</a></li>
    <li><a class="email" href="mailto:chris@excid3.com?subject=hello!">say hello</a></li>
    <li><a class="twitter" href="http://twitter.com/excid3">twitter</a></li>
    <li><a class="github" href="http://github.com/excid3">github</a></li>
  </ul>
</div>
-->


<footer class="clearfix">
  <div class="container">
    <p class="pull-left">Do things that scare you.</p>
    <p class="pull-right">Learn about <a href="http://gorails.com/st-louis-ruby-on-rails">St. Louis Ruby on Rails</a></p>
  </div>
</footer>


    <!-- SubHub.io -->
    <script>
      (function(s,u,b,hh,uu,bb){
        uu=document.createElement(u);
        uu.setAttribute('data-subhub',hh);
        uu.setAttribute('data-panel',true);
        uu.async=1;uu.src=b;
        bb=s.getElementsByTagName(u)[0];
        bb.parentNode.insertBefore(uu,bb);
      })(document, 'script',
        'https://assets.subhub.io/v1/subhub.js',
        'a48820f5-a170-4e4c-97cf-ced8d190679e');
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8399719-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'excid3'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
  </body>
</html>

