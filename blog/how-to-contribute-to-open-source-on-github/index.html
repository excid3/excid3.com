<!DOCTYPE html>
<html>
  <head>
    <title>How To Contribute To Open Source On Github</title>
    <meta name="author" content="Chris Oliver">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta name="google-site-verification" content="k8E8tt4Xn45P84zs5M6Z-4cMIGwdbGMJSDSkL6VzvMk" />

    <!--<link rel="shortcut icon" href="favicon.png">-->
    <link href='/assets/global-09e65ed72b4f08933d57dbbe6ee22514.css' rel='stylesheet' type='text/css' />


    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet" />

    <script type="text/javascript" src="/js/prism.js"></script>

    <script type="text/javascript" data-cfasync="false">
      (function() {
        var config = {
          kitId: 'voa6eso',
          scriptTimeout: 3000
        };
        var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
      })();
    </script>

    <link href="https://plus.google.com/106699287110566383664/" rel="author" />
  </head>
  <body>
    <div class="fluid-container header">
  <div class="container">
    <nav class="pull-right">
      <!--<a href="http://gorails.com" class="btn btn-gorails btn-gorails-green">Learn Ruby On Rails</a>-->
      <!--<a href="/prototype">Prototype</a>
      <a href="/improve">Improve</a>
      <a>|</a>-->
      <a href="http://gorails.com">Learn Ruby on Rails</a>
      <a>|</a>
      <a href="/blog">Blog</a>
      <a href="/contact" class="btn btn-gorails btn-gorails-red">Hire Me</a>
    </nav>
    <h1 class="name"><a href="/">Chris Oliver</a></h1>
  </div>
</div>


    <section id="blog">
      <div class="container">
        <div class="row">
          <div class="span8 offset2">
            <div class="article-head">
              <h2 class="title"><a href="/blog/how-to-contribute-to-open-source-on-github" class="js-pjax">How To Contribute To Open Source On Github</a></h2>
              <p class="date">Jun 18, 2012</p>
            </div><!--/.article-head-->

            <div class="article-content">
              <p>This is a step-by-step outline of the process I take to contribute to open source Rails projects.</p>

<p>Recently I got a great idea for a feature I wanted in Devise that was inspired by my friend <a href="http://8bitbomb.com/">James</a> who I have been helping learn Rails over the past couple weeks.</p>

<p>We were talking about how to handle different types of users, and when the site is simple, there wasn’t a great way to handle this smoothly in Rails using Devise. So I set out to see what I could do.</p>

<p>Since this is something I think a lot of people can be uncomfortable doing, I want to document this process in its entirety. Let’s get to it!</p>

<h3>The Idea</h3>

<p>A lot of sites are simple. You have a single User model, and the user has a <code>role</code> column that just stores a string like “user” or “admin”. Say you want the <code>/dashboard</code> path to be one view for users, and another view for admins. How do you handle this?</p>

<p>Typically with Rails, you’d setup a route for the dashboard and you would either redirect or render based upon the user role. There isn’t much more you can do in the routes:</p>

<pre><code>  authenticated :user do
    get "dashboard" =&gt; "dashboard#show"
  end
</code></pre>

<p>You’d probably end up using a conditional to check what type the user was and render a different view based upon that:</p>

<pre><code>class DashboardController &lt; ApplicationController
  def show
    if current_user.role == "admin"
      render "admin_dashboard"
    else
      render "dashboard"
    end
  end
end
</code></pre>

<p>That's not very clean, plus I'm leaving out any different database queries that need to happen based upon the user. This isn't good. It would be nice if our routes could handle this case and go to a different controller action based upon the user instead. This would fit really well into the <code>authenticated</code> routing method:</p>

<pre><code>  # Admins - showing off my idea
  authenticated :user, lambda {|user| user.role == "admin"} do
    get "dashboard" =&gt; "admin/dashboard#show"
  end

  # Regular users
  authenticated :user do
    get "dashboard" =&gt; "dashboard#show"
  end
</code></pre>

<h3>Validate Your Idea</h3>

<p>So what if this feature already existed in Devise? We don't want to spend our time building something that already exists. I couldn't find anything in the Devise wiki or on a Google search. That's a good sign.</p>

<p>The first thing I did after that was running it by a friend of mine who uses Devise a lot. He thought it was interesting. That's good. Next step is to run over to the <a href="https://github.com/plataformatec/devise" title="Devise">Devise github page</a> and create an issue explaining the idea and asking if it makes sense. The issue for mine was <a href="https://github.com/plataformatec/devise/pull/1922" title="Issue 1922">#1922</a>. I waited a short bit for his response and got this:</p>

<p><img src="http://cl.ly/3u0S0r1t3k3N2s3t2T3k/Screen%20Shot%202012-06-15%20at%2012.10.43%20AM.png" title="Jose Valim" alt="" /></p>

<p>It's approved! Let's get to work.</p>

<h3>Researching</h3>

<p>So now that we know it's a good idea, we want to implement the feature. But where the hell do we start?? For this, I grabbed a fork of Devise so I could have my own copy and cloned it to my computer. You can use the github website to create a fork, and then clone it to your computer like so (provided you use your own git url for your fork).</p>

<pre><code>git clone git@github.com:excid3/devise.git
</code></pre>

<p>Now that I've got a copy of Devise on my computer, we can start looking into it a little better. I know that the <code>authenticated</code> method is related to routing and is going to be called <code>def authenticated</code>. There probably aren't too many methods named that, so this is a good thing we can search for. We open up the terminal and ack for that:</p>

<p><img src="http://cl.ly/2X1T3K1m3y3Z20282V3a/Screen%20Shot%202012-06-15%20at%201.17.32%20AM.png" title="Ack For &quot;def authenticate&quot;" alt="" /></p>

<p>Simple enough. Since the file is in <code>routes.rb</code> and there were no other results, we have to assume we are on the right track.</p>

<p>If you're interested in learning more about Ack, check out this site:</p>

<p>So now that we have the location of the source for the <code>authenticated</code> method, we need to figure out how it works (at least enough to make our contribution). Let's take a look:</p>

<pre><code>    # Allow you to route based on whether a scope is authenticated. You
    # can optionally specify which scope.
    #
    #   authenticated :admin do
    #     root :to =&gt; 'admin/dashboard#show'
    #   end
    #
    #   authenticated do
    #     root :to =&gt; 'dashboard#show'
    #   end
    #
    #   root :to =&gt; 'landing#show'
    #
    def authenticated(scope=nil)
      constraint = lambda do |request|
        request.env["warden"].authenticate? :scope =&gt; scope
      end

      constraints(constraint) do
        yield
      end
    end
</code></pre>

<p>Awesome, it's only a handful of lines! What we've got here is a constraint being set as a lambda...that checks the warden authentication...of a scope...okay what?? At least at the end it creates a regular routing constraint block and yields to the routes in the Rails app! Understanding the last 3 lines isn't bad for a start. <img src="http://excid3.com/blog/wp-includes/images/smilies/icon_smile.gif" alt=":)" /></p>

<p>Let's take a deeper look at the first 3 lines of this method. So, we're assigning this variable as a lambda. A lambda is a block of code that can be executed later. We don't really need to worry about that, but we do need to understand about this whole warden thing.</p>

<p>The one thing we know is that the <code>authenticated :user do</code> route runs successfully when a user has authenticated. So what it looks like is this is creating a block of code that checks if a user is signed in, and then creates a regular Rails constraint out of it. The <code>:user</code> is what is passed in as the "scope". It's not required, and neither should the block we want to add either. Great!</p>

<p>So, the one thing we need before we can get started implementing our change is to figure out this stuff about Warden. What we need is to retrieve the User object from Warden and send it to our block.</p>

<p>If we can figure that part out, we should be able to easily build this feature. And we know this code authenticates the user, so surely there is something similar on the Warden documentation.</p>

<p>What better place to start than <a href="https://github.com/hassox/warden" title="warden">Warden's github page</a>?</p>

<p>Sure enough, if you take a look at the Warden github page, you'll come across this:</p>

<p>The first thing on the page looks interesting:</p>

<pre><code>env['warden'].user # provides the currently logged in user

env['warden'].user(:admin) # allows for scoped authentication, this is the one we want for compatibility with Devise
</code></pre>

<p>That's the missing link! Now we are all set to implement this code.</p>

<h3>Implementation</h3>

<p>So if you scroll up and take a look at what we've got earlier, it's pretty obvious we need to add another parameter for our block. Let's just name it exactly that:</p>

<pre><code>    def authenticated(scope=nil, block=nil)
      ...
    end
</code></pre>

<p>Awesome, now that we have this block, we can ignore it if it is <code>nil</code>, but otherwise we need to execute that block. In ruby you use <code>.call()</code> to do that. We'll pass the warden user into this call method:</p>

<pre><code>block.call(request.env["warden"].user(scope))
</code></pre>

<p>That will call the lambda we send in from the routes file in the Rails app. Now, we need to integrate that logic if the block is left out.</p>

<pre><code>  (block.nil? or block.call(request.env["warden"].user(scope)))
</code></pre>

<p>This will ignore the block if it doesn't exist, but run it if it does. That's good. Now where does this go?</p>

<pre><code>    def authenticated(scope=nil, block=nil)
      constraint = lambda do |request|
        request.env["warden"].authenticate?(:scope =&gt; scope) and (block.nil? or block.call(request.env["warden"].user(scope)))
      end

      constraints(constraint) do
        yield
      end
    end
</code></pre>

<p>Constraints need to return true or false. Tacking the block logic onto the <code>authenticate?</code> makes sure that happens successfully, and then we try to execute the block.</p>

<p>At this point I setup a tiny Rails app with a User model having the role column, and tested the routes that we came up with before. You can do the same, but I'll assume you can take care of that on your own.</p>

<h3>Submitting Your Code</h3>

<p>Github uses pull requests to manage code contributions. They are tightly integrated with Issues, so we can take advantage of what we've already done easily.</p>

<p>First we want to commit our code into git, and push to our git repo.</p>

<pre><code>git commit -am "Added a block to the authenticated route constraint"
git push origin master
</code></pre>

<p>Now that we have our code pushed back up on github (in our own personal copy) we want to attach the changes to our issue and convert it to a pull request. There is a nifty little tool called "hub" you can use for this. Installing it is simple with Ruby:</p>

<pre><code>gem install hub
</code></pre>

<p>And then we can create our pull request:</p>

<pre><code>hub pull-request -i 1922 -b plataformatec:master -h excid3:master
</code></pre>

<p>This creates <a href="https://github.com/plataformatec/devise/pull/1922" title="pull request 1922 for devise">a pull request</a> from Issue #1922 taking the code from <code>excid3:master</code> and suggesting it be merged into the <code>plataformatec:master</code> branch. And that's as simple as it is. You can go back to your pull request or issue url on github and you will see that your commits were linked at the bottom of the activity:</p>

<p><img src="http://cl.ly/2S453u2d3b163Z060E3f/Screen%20Shot%202012-06-15%20at%2012.22.45%20AM.png" title="Pull request commits and questions" alt="" /></p>

<p>You can also see that after I had included the commits I wanted, I asked to see if there were any tests I could write so that in the future, we could be sure that this code still works. Sometimes the author will have tests you can copy, others will not. This is kind of up to the author, but it's best if you can stick with their practices. In my case, he suggested I make one change, and pointed me in the right direction of writing tests.</p>

<p><img src="http://cl.ly/3V231l0I0J0U0T2V2l1H/Screen%20Shot%202012-06-15%20at%209.12.30%20AM.png" title="Pull request update" alt="" /></p>

<p>From here, I updated the code to use the suggested changes and then went on to write some tests for this code. Since writing tests is a whole new set of things to do, I'll leave my code for this out. It'll be unique in every case, but basically I copied a couple tests and added to their test rails app an "active" attribute to admin users. Then I created two routes to test one for each method I modified: <code>authenticate</code> and <code>authenticated</code>. The last step was writing four test cases to make sure that it denied and accepted both active and inactive admins. You can check out the tests I wrote <a href="https://github.com/excid3/devise/commit/37c55eb192ca156ecccbcc1ec095d89f820383d2" title="tests for devise">here</a>.</p>

<p>With testing finished, I submitted them, asked if there was anything left, and successfully got my first feature to Devise accepted!</p>

<p><img src="http://cl.ly/2F2j2y3q2E131a3M2G3B/Screen%20Shot%202012-06-15%20at%201.33.18%20PM.png" title="Merge success" alt="" /></p>

<p>Now you can use my code if you setup your <code>Gemfile</code> to use Devise version 2.1.1 or higher which includes my patch:</p>

<pre><code>gem "devise", "~&gt; 2.1.1"
</code></pre>

<p>Run a <code>bundle install</code> and you're off to the races.</p>

<h3>That Wraps Up How To Contribute To Open Source</h3>

<p>If the primary developers bring up any errors with your code, you can make the changes and Github knows to automatically include them in the pull request until it gets merged.</p>

<p>As you get more advanced with Rails, you'll want to start making a new branch for each of these features to keep things clean and separate. Hopefully this helps explain the process from start to finish. It's not as scary as it seems.</p>

<p>For most people, the first step to contribute to open source is to create an issue with your idea. The majority of developers are happy to help out. They understand how it was when they wanted to contribute to open source projects for the first time.</p>

<p>Now get out there and make <a href="http://github.com/excid3" title="Chris Oliver's github page">my projects</a> more awesome! <img src="http://excid3.com/blog/wp-includes/images/smilies/icon_razz.gif" alt=":P" /></p>


              <p><strong>P.S.</strong> <a href="https://twitter.com/excid3/">You might enjoy following me on Twitter.</a></p>
            </div><!--/.article-content-->

            <nav class="share">
              <a href="https://twitter.com/share" class="twitter-share-button" data-via="excid3" data-related="excid3">Tweet</a>
              <div class="g-plusone" data-size="medium"></div>
              <script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script><script type="IN/Share" data-counter="right"></script>
            </nav>

            <div class="blog-navigation">
              <div class="pull-left">
                
                <a href="/blog/bruce-lee-exceeding-your-level" title="Bruce Lee &#8211; Exceeding Your Level" class="btn btn-gorails btn-gorails-red">&laquo; Bruce Lee &#8211; Exceeding Your Level</a>
                
              </div>

              <div class="pull-right">
                
                <a href="/blog/companies-with-totally-different-goals" title="Companies With Totally Different Goals" class="btn btn-gorails btn-gorails-red">Companies With Totally Different Goals &raquo; </a>
                
              </div>
            </div>

            <div id="disqus_thread"></div>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            <div class="light-well about">
              <a href="http://excid3.com">
                <div class="pull-left">
                  <img src="http://www.gravatar.com/avatar/ce795239ba5dd2384fc2f88ffaff5451.png" alt="Chris Oliver" />
                </div>
                <p>Chris Oliver specializes in web development and user experience design with Ruby on Rails, Javascript, HTML5, and CSS3 in St. Louis, MO</p>
              </a>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!--
<div id="footer-nav">
  <ul>
    <li><a class="home" href="http://excid3.com/blog">home</a></li>
    <li><a class="rss" href="http://feeds.feedburner.com/excid3">rss feed</a></li>
    <li><a class="archives" href="http://excid3.com/blog/archives/">archives</a></li>
    <li><a class="email" href="mailto:chris@excid3.com?subject=hello!">say hello</a></li>
    <li><a class="twitter" href="http://twitter.com/excid3">twitter</a></li>
    <li><a class="github" href="http://github.com/excid3">github</a></li>
  </ul>
</div>
-->


<footer class="clearfix">
  <div class="container">
    <p class="pull-left">Do things that scare you.</p>
    <p class="pull-right">Learn about <a href="http://gorails.com/st-louis-ruby-on-rails">St. Louis Ruby on Rails</a></p>
  </div>
</footer>


    <!-- SubHub.io -->
    <script>
      (function(s,u,b,hh,uu,bb){
        uu=document.createElement(u);
        uu.setAttribute('data-subhub',hh);
        uu.setAttribute('data-panel',true);
        uu.async=1;uu.src=b;
        bb=s.getElementsByTagName(u)[0];
        bb.parentNode.insertBefore(uu,bb);
      })(document, 'script',
        'https://assets.subhub.io/v1/subhub.js',
        'a48820f5-a170-4e4c-97cf-ced8d190679e');
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8399719-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'excid3'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
  </body>
</html>

