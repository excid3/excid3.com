<!DOCTYPE html>
<html>
  <head>
    <title>Blog | Chris Oliver | St. Louis Ruby on Rails Web Developer</title>

    
    <meta name="author" content="Chris Oliver">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="k8E8tt4Xn45P84zs5M6Z-4cMIGwdbGMJSDSkL6VzvMk" />

    <link rel="alternate" type="application/rss+xml" title="Chris Oliver / excid3.com Feed" href="http://excid3.com/feed.xml"/>

    <!--<link rel="shortcut icon" href="favicon.png">-->
    <link href='/assets/global-c224c07eca6e857790f0324871c8800e.css' rel='stylesheet' type='text/css' />


    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet" />

    <script type="text/javascript" data-cfasync="false">
      (function() {
        var config = {
          kitId: 'voa6eso',
          scriptTimeout: 3000
        };
        var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
      })();
    </script>

    <link href="https://plus.google.com/106699287110566383664/" rel="author" />
  </head>
  <body>
    <div class="fluid-container header">
  <div class="container">
    <nav class="pull-right">
      <!--<a href="http://gorails.com" class="btn btn-gorails btn-gorails-green">Learn Ruby On Rails</a>-->
      <!--<a href="/prototype">Prototype</a>
      <a href="/improve">Improve</a>
      <a>|</a>-->
      <a href="http://gorails.com">Learn Ruby on Rails</a>
      <a>|</a>
      <a href="/blog">Blog</a>
      <a href="/contact" class="btn btn-gorails btn-gorails-red">Hire Me</a>
    </nav>
    <h1 class="name"><a href="/">Chris Oliver</a></h1>
  </div>
</div>


    <section id="blog">
  <div class="container">
    <div class="row">
      <div class="span8 offset2">

        <p class="archive">Looking for old posts? Visit the <a href="/blog/archive">archive</a>.</p>

        
          <article class="first">
            <div class="article-head">
              <h2 class="title"><a href="/blog/logging-changes-to-database-with-rails-3" class="js-pjax">Logging Changes To Database With Rails 3</a></h2>
              <p class="date">Apr 07, 2011</p>
            </div><!--/.article-head-->
            <div class="article-content">
              <p>If you’ve ever built an application that has multiple users, you might have considered adding a logging feature to keep track of modifications a user has made. So how do we do this very simply in Rails 3?</p>

<p>First, we need a model to store this information in. Because we are building an extremely simple logging system, we’ll just create a model that’s attached to a user and contains a small string summary of the changes that were made.</p>

<pre><code>rails g model Log user_id:integer modification:string
</code></pre>

<p>After generating the model, you can add a simple search scope to it which allows logs to be searchable as well.</p>

<pre><code>class Log &lt; ActiveRecord::Base
  belongs_to :user
  default_scope ![:o][1] rder =&gt; "created_at DESC"

  def self.search(search)
    if search
      where(["modification LIKE ?", "%#{search}%"])
    else
      scoped
    end
  end
end
</code></pre>

<p>We can setup a User for <code>has_many :logs</code> so we can directly access a user’s actions as well.</p>

<p>Since we’re logging user actions, we can’t access current_user inside of a model. I don’t know the best way to do this, but what I have done, is created a simple function to log a message if the user is logged in. An after filter might be a good use for this type of functionality so you could remove these lines from the controller actions and condense them to a single function called automatically every time.</p>

<p>Sometimes an action may be executed by a user who isn’t signed in, this also takes care of that possibility.</p>

<pre><code>  def log_action(message)
    if current_user
      l = current_user.logs.new(:modification =&gt; message)
      l.save
    end
  end
</code></pre>

<p>In the controller actions, you simply call it and pass in a message like so:</p>

<pre><code>log_action("deleted #{visitor.first_name} #{visitor.last_name}")
</code></pre>

<p>This is a very simple implementation, but the end result is a nice basic searchable log of everything that has happened on the website.</p>

            </div><!--/.article-content-->
          </article>
          <div class="separater"></div>
        
          <article class="middle">
            <div class="article-head">
              <h2 class="title"><a href="/blog/let-users-try-before-they-commit" class="js-pjax">Let Users Try Before They Commit</a></h2>
              <p class="date">Apr 06, 2011</p>
            </div><!--/.article-head-->
            <div class="article-content">
              <p>If you’re like me, you’ve run into many occasions where you hear about a cool new website, but quickly realize you have to sign up to try it out. Screenshots (or lack thereof) make it difficult to truly get a feel for the application. Even if they do support Twitter or Facebook login, you still feel like you shouldn’t need to do that. This kind of first impression gives a subliminal feeling that not only on this one occasion will the software make you do things that are unnecessary and so you end up bookmarking the site at best and never using the app.</p>

<p>Don’t let this be a deterrence to your users. Design your website in a way that they can try the product out before they even have to register. They play around with it for a bit, maybe type in some junk information, maybe they even type in some REAL information. After a while they have come to their decision of whether or not they like your product. But guess what, if they typed in REAL information, you’ve already gotten them to commit to some extent. They invested time really trying out your product. It’s not much to more to ask them to sign up and pay a few dollars monthly to have that information retained next time they come back to the site.</p>

<p>We all try things out in the store, so why not allow the same thing online? More and more applications are providing either free trials or anonymous usage where you can try it out and then save it when you’re done.</p>

<p>Even with a free trial, the barrier to entry can be too much. What if the confirmation email doesn’t go through? What if they don’t remember their password last time they tried it. The level of interest a customer might have is no longer enough for them to keep trying your application. They quickly forget about it and move on.</p>

<p>You don’t want that.</p>

<p><a href="http://fluttrly.com">Fluttrly</a> was pretty much just a personal attempt at learning some Rails 3 features that I was unfamiliar with. I threw it up online and people actually started using it. I got feature requests and people wanting to merge their contributions to the site, all of this was unexpected.</p>

<p>It’s just another todo list. What made the difference was I let people invest their time and when they decided they liked the site, they wanted to save their list privately. Simply ask them to login or sign up then. At that point, they now have an meaningful reason to sign up.</p>

            </div><!--/.article-content-->
          </article>
          <div class="separater"></div>
        
          <article class="last">
            <div class="article-head">
              <h2 class="title"><a href="/blog/rails-security" class="js-pjax">Rails Security</a></h2>
              <p class="date">Mar 30, 2011</p>
            </div><!--/.article-head-->
            <div class="article-content">
              <p>Last week I attended the absolutely wonderful Ruby on Ales conference. Jim Weirich &amp; Matt Yoho gave a presentation on Rails security and I wanted to go over a few of the points.</p>

<h3>SQL Injection</h3>

<p>This shouldn’t be anything new to a web developer. You always hear about this when someone speaks about databases, but it’s easy to forget to sanitize. MYSQL.com recently got <a href="http://seclists.org/fulldisclosure/2011/Mar/309">compromised</a> by this vulnerability and you should always keep it in mind.</p>

<p>So how do we approach this? <strong>NEVER</strong> inject user input into SQL strings. If there is any chance that this could happen, make sure you use the builtin Rails functionality for this. Parameters that need to be passed in by Rails so they can be properly escaped.</p>

<pre><code>Client.where("orders_count = ?", params[:orders])
</code></pre>

<p>Every question mark will be replaced with the next item in the list of arguments passed. They will be properly sanitized and you can safely make SQL queries without worrying about injection.</p>

<h3>Mass Assignment</h3>

<p>This one is a vulnerability that may not be quite apparent from the beginning. Say you have a User model that has a password field. If you use User.update_attributes and params[:user] contains a :password field, then you can simply modify the request to tack on the password attribute and you could change a user’s password.</p>

<p>This is a subtle vulnerability, but easily remedied by whitelists. Instead of using blacklists, which forgotten fields would be exposed, a whitelist allows you to only expose the properties of a model as needed.</p>

<h3>Scope</h3>

<p>Another obscure, and easily overlooked issue is scoping of database queries. Say you have a user owns several private todo lists. Your url has the :id of the todo list and your database query just does a quick find on the List model like so:</p>

<pre><code>List.find(params[:id])
</code></pre>

<p>That’s all find and dandy. It works great and there are no noticeable problems with this. Now the problem here is that we aren’t checking against the current user’s lists. A user has many lists, but they shouldn’t be accessible by other people. The current database query exposes every list to anyone who types in a different id. Instead of this, you can do a query on the current user instead:</p>

<pre><code>current_user.lists.find(params[:id])
</code></pre>

<p>This will scope the query to the current_user’s lists only, permitting only viewing of the lists that user is tied to.</p>

<h3>Cross Site Scripting – XSS</h3>

<p>When a user inputs text, an attacker could insert javascript, which could write out the user’s cookie, and other information. Rails will filter this by default, however if you use the RAW tag, you can bypass this. Sometimes you still want formatting and because of this, the h tag should be used instead.</p>

<h3>Cross Site Request Forgery – CSRF</h3>

<p>When you login to a site, you have a session stored in your cookies. CSRF exploits this by having a remote site redirect you to a URL on another site where you are logged in. This redirect can be used to request a action or other action on a different site. Rails 3 protects against this by default by supplying a CSRF token embedded into every form that is rendered. It is important to use the provided form generators instead of writing raw HTML forms because of this. Don’t use GET requests to modify the database because they will have no CSRF token to check against.</p>

<h3>Rails Security Summary</h3>

<p>Most of these Rails security tips can be applied to any web development. Things like mass assignment are more Rails specific, but you can see how they could also be applied to other web frameworks. This is by no means a guide to fully protecting a Rails (or any) web app, however it is a good start to understanding the common attacks and ideas behind them.</p>

<p>For a more in-depth explanation of Rails security, check out the <a href="http://guides.rubyonrails.org/security.html">Rails Security guide</a>.</p>

            </div><!--/.article-content-->
          </article>
          
        

        <div class="blog-navigation">

          <!--<span class="page_number ">Page: 48 of 79</span>-->

          <div class="pull-left">
            
              <a href="/blog/page-49" class="btn btn-gorails btn-gorails-red next">← Older Posts</a>
            
          </div>

          <div class="pull-right">
            
              
                <a href="/blog/page-47" class="btn btn-gorails btn-gorails-red previous">Newer Posts →</a>
              
            
          </div>
        </div>

      </div>
    </div>
  </div>
</section>


    <!--
<div id="footer-nav">
  <ul>
    <li><a class="home" href="http://excid3.com/blog">home</a></li>
    <li><a class="rss" href="http://feeds.feedburner.com/excid3">rss feed</a></li>
    <li><a class="archives" href="http://excid3.com/blog/archives/">archives</a></li>
    <li><a class="email" href="mailto:chris@excid3.com?subject=hello!">say hello</a></li>
    <li><a class="twitter" href="http://twitter.com/excid3">twitter</a></li>
    <li><a class="github" href="http://github.com/excid3">github</a></li>
  </ul>
</div>
-->


<footer class="clearfix">
  <div class="container">
    <p class="pull-left">Do things that scare you.</p>
    <p class="pull-right">Learn about <a href="http://gorails.com/st-louis-ruby-on-rails">St. Louis Ruby on Rails</a></p>
  </div>
</footer>


    <!-- Google Analytics -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8399719-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>
