<!DOCTYPE html>
<html>
  <head>
    <title>Blog | Chris Oliver | St. Louis Ruby on Rails Web Developer</title>

    
    <meta name="author" content="Chris Oliver">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="k8E8tt4Xn45P84zs5M6Z-4cMIGwdbGMJSDSkL6VzvMk" />

    <link rel="alternate" type="application/rss+xml" title="Chris Oliver / excid3.com Feed" href="http://excid3.com/feed.xml"/>

    <!--<link rel="shortcut icon" href="favicon.png">-->
    <link href='/assets/global-c224c07eca6e857790f0324871c8800e.css' rel='stylesheet' type='text/css' />


    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet" />

    <script type="text/javascript" data-cfasync="false">
      (function() {
        var config = {
          kitId: 'voa6eso',
          scriptTimeout: 3000
        };
        var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
      })();
    </script>

    <link href="https://plus.google.com/106699287110566383664/" rel="author" />
  </head>
  <body>
    <div class="fluid-container header">
  <div class="container">
    <nav class="pull-right">
      <!--<a href="http://gorails.com" class="btn btn-gorails btn-gorails-green">Learn Ruby On Rails</a>-->
      <!--<a href="/prototype">Prototype</a>
      <a href="/improve">Improve</a>
      <a>|</a>-->
      <a href="http://gorails.com">Learn Ruby on Rails</a>
      <a>|</a>
      <a href="/blog">Blog</a>
      <a href="/contact" class="btn btn-gorails btn-gorails-red">Hire Me</a>
    </nav>
    <h1 class="name"><a href="/">Chris Oliver</a></h1>
  </div>
</div>


    <section id="blog">
  <div class="container">
    <div class="row">
      <div class="span8 offset2">

        <p class="archive">Looking for old posts? Visit the <a href="/blog/archive">archive</a>.</p>

        
          <article class="first">
            <div class="article-head">
              <h2 class="title"><a href="/blog/rails-tip-7-mass-assignment-security" class="js-pjax">Rails Tip #7: Mass Assignment Security</a></h2>
              <p class="date">Mar 09, 2012</p>
            </div><!--/.article-head-->
            <div class="article-content">
              <p>I know everyone has been writing about this lately, so pardon yet another article on the pile, but this is a serious issue that people need to take into consideration daily.</p>

<p>Since the recent Github fiasco, there has been a lot of talk about security on the web. This was an <a href="https://github.com/blog/1068-public-key-security-vulnerability-and-mitigation">exceptional response</a> on their part, and something that every single one of us needs to take seriously instead of pointing fingers at people, companies, and frameworks.</p>

<p>Let’s dive into the vulnerability.</p>

<h2>Mass Assignment</h2>

<p>When you create a form in Rails, you’re effectively mapping form values to a hash:</p>

<p>This hash’s values get assigned to the attributes of the Rails model you’re creating:</p>

<pre><code>Parameters:
{
  "commit"=&gt;"Submit",
  "post"=&gt;{
    "title"=&gt;;"First Post",
    "content"=&gt;;"This is the content for the first post."
  }
}
</code></pre>

<p>We access that in our controller’s create action:</p>

<pre><code>def create
  @post = Post.new params[:post]        # THIS IS THE IMPORTANT LINE

  if @post.save
    redirect_to @post, :notice =&gt; "Successfully created."
  else
    render :action =&gt; :new
  end
end

# Update is affected as well

def update
  @post = Post.find params[:id]

  if @post.update_attributes params[:post]      # ALSO USES THE PARAMS HASH
    redirect_to @post, :notice =&gt; "Successfully updated."
  else
    render :action =&gt; :edit
  end
end
</code></pre>

<p>On line 2 here, the params are passed into the new Post object. That is where the submitted form data is assigned to the model and then saved to the database.</p>

<p><strong>And that’s where the problem lies.</strong></p>

<p>By default, a user can update any attributes. So if you decide to allow users to be “admins”, then removing a field in the form that is for admins only is not good enough. A user can still submit the admin only param without permission.</p>

<h2>The solution: <code>attr_accessible</code></h2>

<p>The solution for this is <code>attr_accessible</code>. This method tells your model which attributes can be assigned via hash like in the <code>create</code> action we saw earlier.</p>

<p>Let’s do this by example. Pretend we don’t want people updating the <code>:important</code> attribute on a Post. What do we do?</p>

<p>The first thing, is that we should require <code>attr_accessible</code> be on all of our models. In <code>application.rb</code>, uncomment this line:</p>

<pre><code>config.active_record.whitelist_attributes = true
</code></pre>

<p>This no longer allows any of the attributes on any models to be set through mass assignment. That’s good.</p>

<p>Now we have to update the model to allow certain attributes:</p>

<pre><code>class Post &lt; ActiveRecord::Base
  attr_accessible :title, :content
end
</code></pre>

<p>When you try to attack the site by sending over a <code>:important</code> attribute, it will simply be ignored now. This is exactly what we want.</p>

<p>Rails will throw an exception in development if a protected attribute is attempted to be set. In production, no exception will be raised, the attribute will juts be ignored. That's a good start.</p>

<h2>What if we want some users to be able to set a protected attribute though?</h2>

<p>In our case, let's say that we want admin users to be able to update the <code>:important</code> attribute. If attr_accessible doesn't allow us to save <code>:important</code>, then how do we actually set it??</p>

<p>Let's fix up the controller to allow this for users who are admins. We'll be using Devise with a boolean <code>:admin</code> column on the user so that is where <code>current_user</code> will be coming from.</p>

<p>Let's hop back in our controller and fix things up:</p>

<pre><code>def create
  # Remove the insecure item(s) so we don't throw an exception in development
  important = params[:post].delete :important

  # Create the new post as normal
  @post = Post.new(params[:post])

  # If the user is allowed update this attribute, explicitly set it
  @post.important = important if current_user.admin?

  if @post.save
    redirect_to @post, :notice =&gt; "Successfully created."
  else
    render :action =&gt; :new
  end
end

# Update is affected as well

def update
  # Strip out the protected params so we don't throw exceptions in development
  important = params[:post].delete :important

  # Grab the post as usual
  @post = Post.find(params[:id])

  # Set the attributes like we do in create
  @post.attributes = params[:post]

  # Explicitly update the important attribute only if the user is an admin
  @post.important = important if current_user.admin?

  if @post.save
    redirect_to @post, :notice =&gt; "Successfully updated."
  else
    render :action =&gt; :edit
  end
end
</code></pre>

<p>And this will allow any type of user to update the title and content attributes, but only admins are safely allowed to update the important field.</p>

<p>The important part to take note of here is that we are explicitly setting the protected attributes. We know <strong>exactly</strong> what we are doing when we want to set those attributes, so this (aside from logic problems) makes updating these attributes protected from mass assignment while still being usable.</p>

<p>Another important benefit of <code>attr_accessible</code> is that any new fields we add to the model are immediately protected. This whitelist approach makes sure that we have to declare fields as "safe" which leads to much fewer security holes when changing this code in the future because it forces you to not be forgetful.</p>

<h2>Conclusion</h2>

<p>This is certainly a feature that will be updated in the future versions of Rails. The current solutions aren't exceptionally graceful, so I'm sure that we'll see some nice improvements soon.</p>

<p>In the mean time, keep with whitelisting attributes, and if have a lot of dynamic attributes that depend on the user roles, check out dynamic <code>attr_accessible</code> on <a href="http://railscasts.com/episodes/237-dynamic-attr-accessible">Railscast 237</a>.</p>

            </div><!--/.article-content-->
          </article>
          <div class="separater"></div>
        
          <article class="middle">
            <div class="article-head">
              <h2 class="title"><a href="/blog/ntfs-support-on-osx-lion-10-7" class="js-pjax">NTFS Support On OSX Lion 10.7</a></h2>
              <p class="date">Feb 27, 2012</p>
            </div><!--/.article-head-->
            <div class="article-content">
              <p>Today I was about to backup some files to my external drive, I realized I hadn’t installed anything to allow writing to NTFS on OSX Lion yet. After <a href="http://blog.nolar.info/ntfs-3g-in-mac-os-x-lion-10-7-with-read-write-support/">researching the problem</a>, it’s relatively easy, but not entirely perfect.</p>

<h2>Install OSXFUSE</h2>

<p>Hop on over to the new successor to MacFUSE and grab the download here: . I installed this including the MacFUSE compatibility option.</p>

<h2>Install NTFS-3G</h2>

<p>The free NTFS-3G we need to install next. You can grab that **<a href="http://sourceforge.net/projects/catacombae/files/NTFS-3G%20for%20Mac%20OS%20X/2010.10.2/">here**</a>.</p>

<p>It looks like this has been defunct for a while, but there is a <a href="http://www.tuxera.com/products/tuxera-ntfs-for-mac/">paid version</a> that is replacing it.</p>

<h2>Reboot!</h2>

<p>Your drive should now be writable. You may find that you are getting this timeout error:</p>

<p><img src="http://excid3.com/blog/wp-content/uploads/2012/02/ntfs-3g-15seconds-signal-error.png" title="ntfs-3g-15seconds-signal-error" alt="" /></p>

<p>This shouldn’t cause any problems, but if you would like, you can install this fix:  based on the code here:</p>

<p>Everything seems to be working splendidly after that. It’s a little more trouble than you’d imagine it should be, but all in all, not too bad.</p>

<p><a href="http://blog.nolar.info/ntfs-3g-in-mac-os-x-lion-10-7-with-read-write-support/">Source</a></p>

            </div><!--/.article-content-->
          </article>
          <div class="separater"></div>
        
          <article class="last">
            <div class="article-head">
              <h2 class="title"><a href="/blog/rails-tip-6-simple-calendar-for-rails-3" class="js-pjax">Rails Tip #6: Simple Calendar For Rails 3</a></h2>
              <p class="date">Feb 20, 2012</p>
            </div><!--/.article-head-->
            <div class="article-content">
              <p>Calendar gems for Rails are known for being kind of ridiculous. They’re typically messy and/or bundled with a whole bunch of css and js that you don’t really need or want. If you do, you’re probably going to want to roll your own anyways.</p>

<h2>Announcing <code>simple_calendar</code></h2>

<p>Using <code>simple_calendar</code> is easy. You simply query for your items in the controller as normal:</p>

<pre><code>  def calendar
    @events = Event.all
  end
</code></pre>

<p>And then in the view (for example: <code>app/views/main/calendar.html.erb</code>) you can display them in a calendar:</p>

<p>You can also add the following line to your css to guarantee that dates in the calendar have the same height and widths:</p>

<pre><code>  .calendar td { height: 100px; width: 14.28%; }
</code></pre>

<p>And voila! You’re ready to go. If you toss up Twitter Bootstrap on the site, you can get a slick looking calendar in a matter of minutes:</p>

<p><img src="http://cl.ly/3d152G2r3U0p1o2y3I2v/Screen%20Shot%202012-02-19%20at%209.31.20%20PM.png" alt="" /></p>

<h2>In Progress</h2>

<p>This gem is definitely just getting started. There are lots of future additions I’d like to add, and I’m sure people have great ideas for things I can add as well.</p>

<p>You can find <code>simple_calendar</code> here:</p>

<p>Be sure to discuss ideas in the comments!</p>

            </div><!--/.article-content-->
          </article>
          
        

        <div class="blog-navigation">

          <!--<span class="page_number ">Page: 23 of 79</span>-->

          <div class="pull-left">
            
              <a href="/blog/page-24" class="btn btn-gorails btn-gorails-red next">← Older Posts</a>
            
          </div>

          <div class="pull-right">
            
              
                <a href="/blog/page-22" class="btn btn-gorails btn-gorails-red previous">Newer Posts →</a>
              
            
          </div>
        </div>

      </div>
    </div>
  </div>
</section>


    <!--
<div id="footer-nav">
  <ul>
    <li><a class="home" href="http://excid3.com/blog">home</a></li>
    <li><a class="rss" href="http://feeds.feedburner.com/excid3">rss feed</a></li>
    <li><a class="archives" href="http://excid3.com/blog/archives/">archives</a></li>
    <li><a class="email" href="mailto:chris@excid3.com?subject=hello!">say hello</a></li>
    <li><a class="twitter" href="http://twitter.com/excid3">twitter</a></li>
    <li><a class="github" href="http://github.com/excid3">github</a></li>
  </ul>
</div>
-->


<footer class="clearfix">
  <div class="container">
    <p class="pull-left">Do things that scare you.</p>
    <p class="pull-right">Learn about <a href="http://gorails.com/st-louis-ruby-on-rails">St. Louis Ruby on Rails</a></p>
  </div>
</footer>


    <!-- Google Analytics -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8399719-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>
