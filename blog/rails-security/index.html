<!DOCTYPE html>
<html>
  <head>
    <title>Rails Security</title>
    <meta name="author" content="Chris Oliver">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta name="google-site-verification" content="k8E8tt4Xn45P84zs5M6Z-4cMIGwdbGMJSDSkL6VzvMk" />

    <!--<link rel="shortcut icon" href="favicon.png">-->
    <link href='/assets/global-09e65ed72b4f08933d57dbbe6ee22514.css' rel='stylesheet' type='text/css' />


    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet" />

    <script type="text/javascript" src="/js/prism.js"></script>

    <script type="text/javascript" data-cfasync="false">
      (function() {
        var config = {
          kitId: 'voa6eso',
          scriptTimeout: 3000
        };
        var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
      })();
    </script>

    <link href="https://plus.google.com/106699287110566383664/" rel="author" />
  </head>
  <body>
    <div class="fluid-container header">
  <div class="container">
    <nav class="pull-right">
      <!--<a href="http://gorails.com" class="btn btn-gorails btn-gorails-green">Learn Ruby On Rails</a>-->
      <!--<a href="/prototype">Prototype</a>
      <a href="/improve">Improve</a>
      <a>|</a>-->
      <a href="http://gorails.com">Learn Ruby on Rails</a>
      <a>|</a>
      <a href="/blog">Blog</a>
      <a href="/contact" class="btn btn-gorails btn-gorails-red">Hire Me</a>
    </nav>
    <h1 class="name"><a href="/">Chris Oliver</a></h1>
  </div>
</div>


    <section id="blog">
      <div class="container">
        <div class="row">
          <div class="span8 offset2">
            <div class="article-head">
              <h2 class="title"><a href="/blog/rails-security" class="js-pjax">Rails Security</a></h2>
              <p class="date">Mar 30, 2011</p>
            </div><!--/.article-head-->

            <div class="article-content">
              <p>Last week I attended the absolutely wonderful Ruby on Ales conference. Jim Weirich &amp; Matt Yoho gave a presentation on Rails security and I wanted to go over a few of the points.</p>

<h3>SQL Injection</h3>

<p>This shouldn’t be anything new to a web developer. You always hear about this when someone speaks about databases, but it’s easy to forget to sanitize. MYSQL.com recently got <a href="http://seclists.org/fulldisclosure/2011/Mar/309">compromised</a> by this vulnerability and you should always keep it in mind.</p>

<p>So how do we approach this? <strong>NEVER</strong> inject user input into SQL strings. If there is any chance that this could happen, make sure you use the builtin Rails functionality for this. Parameters that need to be passed in by Rails so they can be properly escaped.</p>

<pre><code>Client.where("orders_count = ?", params[:orders])
</code></pre>

<p>Every question mark will be replaced with the next item in the list of arguments passed. They will be properly sanitized and you can safely make SQL queries without worrying about injection.</p>

<h3>Mass Assignment</h3>

<p>This one is a vulnerability that may not be quite apparent from the beginning. Say you have a User model that has a password field. If you use User.update_attributes and params[:user] contains a :password field, then you can simply modify the request to tack on the password attribute and you could change a user’s password.</p>

<p>This is a subtle vulnerability, but easily remedied by whitelists. Instead of using blacklists, which forgotten fields would be exposed, a whitelist allows you to only expose the properties of a model as needed.</p>

<h3>Scope</h3>

<p>Another obscure, and easily overlooked issue is scoping of database queries. Say you have a user owns several private todo lists. Your url has the :id of the todo list and your database query just does a quick find on the List model like so:</p>

<pre><code>List.find(params[:id])
</code></pre>

<p>That’s all find and dandy. It works great and there are no noticeable problems with this. Now the problem here is that we aren’t checking against the current user’s lists. A user has many lists, but they shouldn’t be accessible by other people. The current database query exposes every list to anyone who types in a different id. Instead of this, you can do a query on the current user instead:</p>

<pre><code>current_user.lists.find(params[:id])
</code></pre>

<p>This will scope the query to the current_user’s lists only, permitting only viewing of the lists that user is tied to.</p>

<h3>Cross Site Scripting – XSS</h3>

<p>When a user inputs text, an attacker could insert javascript, which could write out the user’s cookie, and other information. Rails will filter this by default, however if you use the RAW tag, you can bypass this. Sometimes you still want formatting and because of this, the h tag should be used instead.</p>

<h3>Cross Site Request Forgery – CSRF</h3>

<p>When you login to a site, you have a session stored in your cookies. CSRF exploits this by having a remote site redirect you to a URL on another site where you are logged in. This redirect can be used to request a action or other action on a different site. Rails 3 protects against this by default by supplying a CSRF token embedded into every form that is rendered. It is important to use the provided form generators instead of writing raw HTML forms because of this. Don’t use GET requests to modify the database because they will have no CSRF token to check against.</p>

<h3>Rails Security Summary</h3>

<p>Most of these Rails security tips can be applied to any web development. Things like mass assignment are more Rails specific, but you can see how they could also be applied to other web frameworks. This is by no means a guide to fully protecting a Rails (or any) web app, however it is a good start to understanding the common attacks and ideas behind them.</p>

<p>For a more in-depth explanation of Rails security, check out the <a href="http://guides.rubyonrails.org/security.html">Rails Security guide</a>.</p>


              <p><strong>P.S.</strong> <a href="https://twitter.com/excid3/">You might enjoy following me on Twitter.</a></p>
            </div><!--/.article-content-->

            <nav class="share">
              <a href="https://twitter.com/share" class="twitter-share-button" data-via="excid3" data-related="excid3">Tweet</a>
              <div class="g-plusone" data-size="medium"></div>
              <script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script><script type="IN/Share" data-counter="right"></script>
            </nav>

            <div class="blog-navigation">
              <div class="pull-left">
                
                <a href="/blog/productivity-hacks" title="Productivity Hacks" class="btn btn-gorails btn-gorails-red">&laquo; Productivity Hacks</a>
                
              </div>

              <div class="pull-right">
                
                <a href="/blog/let-users-try-before-they-commit" title="Let Users Try Before They Commit" class="btn btn-gorails btn-gorails-red">Let Users Try Before They Commit &raquo; </a>
                
              </div>
            </div>

            <div id="disqus_thread"></div>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            <div class="light-well about">
              <a href="http://excid3.com">
                <div class="pull-left">
                  <img src="http://www.gravatar.com/avatar/ce795239ba5dd2384fc2f88ffaff5451.png" alt="Chris Oliver" />
                </div>
                <p>Chris Oliver specializes in web development and user experience design with Ruby on Rails, Javascript, HTML5, and CSS3 in St. Louis, MO</p>
              </a>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!--
<div id="footer-nav">
  <ul>
    <li><a class="home" href="http://excid3.com/blog">home</a></li>
    <li><a class="rss" href="http://feeds.feedburner.com/excid3">rss feed</a></li>
    <li><a class="archives" href="http://excid3.com/blog/archives/">archives</a></li>
    <li><a class="email" href="mailto:chris@excid3.com?subject=hello!">say hello</a></li>
    <li><a class="twitter" href="http://twitter.com/excid3">twitter</a></li>
    <li><a class="github" href="http://github.com/excid3">github</a></li>
  </ul>
</div>
-->


<footer class="clearfix">
  <div class="container">
    <p class="pull-left">Do things that scare you.</p>
    <p class="pull-right">Learn about <a href="http://gorails.com/st-louis-ruby-on-rails">St. Louis Ruby on Rails</a></p>
  </div>
</footer>


    <!-- SubHub.io -->
    <script>
      (function(s,u,b,hh,uu,bb){
        uu=document.createElement(u);
        uu.setAttribute('data-subhub',hh);
        uu.setAttribute('data-panel',true);
        uu.async=1;uu.src=b;
        bb=s.getElementsByTagName(u)[0];
        bb.parentNode.insertBefore(uu,bb);
      })(document, 'script',
        'https://assets.subhub.io/v1/subhub.js',
        'a48820f5-a170-4e4c-97cf-ced8d190679e');
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8399719-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'excid3'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
  </body>
</html>

