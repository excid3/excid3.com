<!DOCTYPE html>
<html>
  <head>
    <title>Logging Module Troubles</title>
    <meta name="author" content="Chris Oliver">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta name="google-site-verification" content="k8E8tt4Xn45P84zs5M6Z-4cMIGwdbGMJSDSkL6VzvMk" />

    <!--<link rel="shortcut icon" href="favicon.png">-->
    <link href='/assets/global-09e65ed72b4f08933d57dbbe6ee22514.css' rel='stylesheet' type='text/css' />


    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet" />

    <script type="text/javascript" src="/js/prism.js"></script>

    <script type="text/javascript" data-cfasync="false">
      (function() {
        var config = {
          kitId: 'voa6eso',
          scriptTimeout: 3000
        };
        var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
      })();
    </script>

    <link href="https://plus.google.com/106699287110566383664/" rel="author" />
  </head>
  <body>
    <div class="fluid-container header">
  <div class="container">
    <nav class="pull-right">
      <!--<a href="http://gorails.com" class="btn btn-gorails btn-gorails-green">Learn Ruby On Rails</a>-->
      <!--<a href="/prototype">Prototype</a>
      <a href="/improve">Improve</a>
      <a>|</a>-->
      <a href="http://gorails.com">Learn Ruby on Rails</a>
      <a>|</a>
      <a href="/blog">Blog</a>
      <a href="/contact" class="btn btn-gorails btn-gorails-red">Hire Me</a>
    </nav>
    <h1 class="name"><a href="/">Chris Oliver</a></h1>
  </div>
</div>


    <section id="blog">
      <div class="container">
        <div class="row">
          <div class="span8 offset2">
            <div class="article-head">
              <h2 class="title"><a href="/blog/logging-module-troubles" class="js-pjax">Logging Module Troubles</a></h2>
              <p class="date">Aug 11, 2009</p>
            </div><!--/.article-head-->

            <div class="article-content">
              <p>Recently I was helping mac9416 work on CLI parsing for the upcoming Keryx 1.0. He was running into some trouble with the logging module. What happened was that everything he was setting up for the logger was basically being overwritten with the defaults. The original code looked something like this, with libkeryx importing logging as well.</p>

<blockquote><p><code>import logging, platform, sys
from optparse import OptionParser</code></p>

<p>LOG_FORMAT = '%(asctime)s %(levelname) %(message)s'
DATE = '%a, %d %b %Y %H:%M:%S'</p>

<p>def parse(args=None):
""" Parses options and arguments passed """
parser = OptionParser(usage=USAGE, version='%s %s' % (PROGRAM, VERSION))
parser.set_defaults(log_level=logging.WARNING)
parser.add_option('-V', '--verbose', action='store_const', dest="log_level", const=logging.INFO, help='Show vervose output')
parser.add_option('-d', '--debug', action='store_const', dest="log_level", const=logging.DEBUG, help='Show debugging output')
return parser.parse_args()</p>

<p>def main(argv=None):
""" Main function of execution """
import libkeryx
opts, args = parse()
print opts.log_level
logging.basicConfig(name=lib.appName, level=opts.log_level, format=LOG_FORMAT, date=DATE)</p></blockquote>

<p>And this was giving the output as such:</p>

<blockquote><p><code>ERROR:root:message</code></p></blockquote>

<p>This did not print any of our info or debug messages because it defaults to the ERROR logging level.What we were looking for was using the root logger across all modules so that we could have a single logging mechanism that would be easily set at the same level of any frontend. This wasnâ€™t using our customized message format, nor was it using the proper logging level. It was set properly, but nothing was working correct.</p>

<p>After a bit of trial and error, I found the solution. In libkeryx, we were importing logging. The logging module was being first imported in the main python file, then it was being setup in libkeryx, and THEN it was being initialized with our basicConfig in the main file. This causes problems because logging is imported in multiple locations and is not configured beforehand. The solution? First thing, import logging, parse the CLI arguments and configure logging before you do anything else:</p>

<blockquote><p><code># Setup logging
import logging</code></p>

<p>def parse(args=None):
""" Parses options and arguments passed """
parser = OptionParser(usage=USAGE, version='%s %s' % (PROGRAM, VERSION))
parser.set_defaults(log_level=logging.WARNING)
parser.add_option('-V', '--verbose', action='store_const', dest="log_level", const=logging.INFO, help='Show vervose output')
parser.add_option('-d', '--debug', action='store_const', dest="log_level", const=logging.DEBUG, help='Show debugging output')
return parser.parse_args()</p>

<p>opts, args = parse()</p>

<p>LOG_FORMAT = '%(asctime)s %(levelname)-8s %(message)s'
DATE = '%a, %d %b %Y %H:%M:%S'
logging.basicConfig(level=opts.log_level, format=LOG_FORMAT, date=DATE)</p>

<h1>Rest of imports go here</h1>

<p>import libkeryx</p></blockquote>

<p>What this does is allows us to configure the root logger before everyone else gets a hold of it. This gives it default properties of level, format, and date automatically to the other modules that use it, in our case, libkeryx. Order is key here, and because libkeryx is just a module, we want it to automatically inherit the logging level of the script importing it.</p>


              <p><strong>P.S.</strong> <a href="https://twitter.com/excid3/">You might enjoy following me on Twitter.</a></p>
            </div><!--/.article-content-->

            <nav class="share">
              <a href="https://twitter.com/share" class="twitter-share-button" data-via="excid3" data-related="excid3">Tweet</a>
              <div class="g-plusone" data-size="medium"></div>
              <script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script><script type="IN/Share" data-counter="right"></script>
            </nav>

            <div class="blog-navigation">
              <div class="pull-left">
                
                <a href="/blog/keryx-0-92-2-release-and-the-project-matures" title="Keryx 0.92.2 Release and the Project Matures" class="btn btn-gorails btn-gorails-red">&laquo; Keryx 0.92.2 Release and the Project Matures</a>
                
              </div>

              <div class="pull-right">
                
                <a href="/blog/gsoc-2009-ends-today" title="GSoC 2009 Ends Today" class="btn btn-gorails btn-gorails-red">GSoC 2009 Ends Today &raquo; </a>
                
              </div>
            </div>

            <div id="disqus_thread"></div>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            <div class="light-well about">
              <a href="http://excid3.com">
                <div class="pull-left">
                  <img src="http://www.gravatar.com/avatar/ce795239ba5dd2384fc2f88ffaff5451.png" alt="Chris Oliver" />
                </div>
                <p>Chris Oliver specializes in web development and user experience design with Ruby on Rails, Javascript, HTML5, and CSS3 in St. Louis, MO</p>
              </a>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!--
<div id="footer-nav">
  <ul>
    <li><a class="home" href="http://excid3.com/blog">home</a></li>
    <li><a class="rss" href="http://feeds.feedburner.com/excid3">rss feed</a></li>
    <li><a class="archives" href="http://excid3.com/blog/archives/">archives</a></li>
    <li><a class="email" href="mailto:chris@excid3.com?subject=hello!">say hello</a></li>
    <li><a class="twitter" href="http://twitter.com/excid3">twitter</a></li>
    <li><a class="github" href="http://github.com/excid3">github</a></li>
  </ul>
</div>
-->


<footer class="clearfix">
  <div class="container">
    <p class="pull-left">Do things that scare you.</p>
    <p class="pull-right">Learn about <a href="http://gorails.com/st-louis-ruby-on-rails">St. Louis Ruby on Rails</a></p>
  </div>
</footer>


    <!-- SubHub.io -->
    <script>
      (function(s,u,b,hh,uu,bb){
        uu=document.createElement(u);
        uu.setAttribute('data-subhub',hh);
        uu.setAttribute('data-panel',true);
        uu.async=1;uu.src=b;
        bb=s.getElementsByTagName(u)[0];
        bb.parentNode.insertBefore(uu,bb);
      })(document, 'script',
        'https://assets.subhub.io/v1/subhub.js',
        'a48820f5-a170-4e4c-97cf-ced8d190679e');
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8399719-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'excid3'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
  </body>
</html>

